<!DOCTYPE html>
<html>
<head>
    <title>OAuth Redirect</title>
</head>
<body>
    <p id="status-message">Processing your authorization...</p>
    <script>
        // Function to parse the query parameters from the URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Extract the authorization code from the URL
        const authCode = getQueryParam('code');
        const statusMessageElement = document.getElementById('status-message');

        if (authCode) {
            console.log('Authorization Code:', authCode);

            // Send the code to your backend
            fetch('http://localhost:3000/exchange-code', { // Replace with your backend's URL
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ code: authCode }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Backend Response:', data);

                // Update the text based on the response
                if (data.message === 'Tokens saved successfully') {
                    statusMessageElement.textContent = "It worked!";
                } else {
                    statusMessageElement.textContent = "It did not work :(";
                }
            })
            .catch(error => {
                console.error('Error sending code to backend:', error);
                statusMessageElement.textContent = "It did not work :(";
            });
        } else {
            console.error('Authorization code not found in URL.');
            statusMessageElement.textContent = "It did not work :(";
        }
    </script>
</body>
</html>
